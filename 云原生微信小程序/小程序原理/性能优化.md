架构层（双线程模型）、链路层（授权模型）、和应用层（自定义组件）三个角度学习了小程序的技术要点。它们能帮你完成一个微信小程序的基本业务逻辑和交互逻辑。

逻辑的第一诉求必然是支撑功能，对端侧应用来说，功能是一方面，功能之外是用户体验也至关重要，良好的体验能加强用户对于应用的认同甚至依赖。小程序作为一种端侧应用，与其他应用端(Web/App) 一样需要关注用户体验。用户体验有2个核心要素：一是设计；二是性能。

掌握底层的技术原理能帮助我们写出性能更好的代码，不过理论在转化为实践时往往不是非常直观，所以在掌握理论的同学会利用工具更为重要。

## 微信IDE

- 性能评分是通过对页面渲染、网络、JS 脚本等方面的评估综合得来的；
- 体验评分是从设计和交互等方面评估而来，由于设计和交互存在一定的主观因素，所以体验的评分权当建议；
- 最佳实践涉及的方面更宽泛，除了代码编写方面的建议，还有安全和用户体验方面的建议。

## 小程序性能优化的具体维度

1. 避免过大的 WXML 节点数目
2. 里面执行脚本的耗时过长的情况
3. 避免首屏时间太长的情况
4. 避免渲染界面的耗时过长的情况
5. 对网络请求做必要的缓存以避免多余的请求
6. 所有请求的耗时不应太久
7. 避免 setData 的调用多余频繁
8. 避免 setData 的数据过大
9. 避免短时间内发起太多的图片请求
10. 避免短时间内发起太多的请求

10 个性能评分标准并不仅仅适用于微信小程序，有几条是前端开发领域的通用性能指标，而且如果你用过 Vue/React 之类的 MVVM 框架，以上指标可以全部应用到基于 Vue/React 框架开发的 Web 应用程序中。

## 浏览器的渲染流程

HTML 是 XML 的变体，在渲染的时候首先会被浏览器内核解析为 DOM 树，这是一种树形结构，然后会解析每个节点标签的类型、属性等要素，最后与 JavaScript 脚本和 CSS 结合起来进而在经过布局和绘制完成整个渲染流程。

DOM 树的结构越复杂，渲染的管线就会越慢。当渲染线程执行的同时，逻辑线程是被阻塞的，也就是说如果渲染线程长时间占用了队列，这期间浏览器出于无法响应用户交互行为的“假死”状态，这对于用户体验是致命的。

## 执行脚本的耗时时间

执行脚本的耗时过长对于性能的不良影响主要体现在两个时期：

- 第一是在小程序加载完成后的首次渲染期间。
- 第二是小程序运行时过程中的处理用户交互时期。

## 避免首屏时间太长

影响首屏时间的因素非常多（比如DNS解析耗时、TCP 链接的建立耗时......）对于小程序开发者来说，有些因素是不可控的（比如DNS解析），那么在可控的众多因素当中，最核心的两个优化方向是：

- 代码优化；
- 网站优化;

代码方向的优化措施重点关注这样几点：

- 降低 WXML 的结构复杂度，比如节点个数和深度；
- 降低首次渲染的数据规模，首次渲染只包含核心数据，非核心数据的渲染可推迟到首屏渲染完成之后进行；
- 从设计和交互的角度出发，在实际内容被渲染之前展示友好的 laoding 效果。

网络优化的核心是为了降低 RTT ，也就是微信 IDE 给出的 "所有请求的耗时不应太多"。由于小程序的所有资源均托放在微信的服务器，所以不存在 CDN 和 DNS优化问题，降低 RTT 最有效的两个措施是：

- 减少网络请求所携带的数据体积，这是最直观的网络优化方案；
- 提高服务器处理网络请求的速度。

## 避免渲染界面的耗时过长的情况

渲染主要包括两个角度：一是首屏的渲染时间，二是小程序运行期间的界面更新所需的渲染时间，也就是动态渲染。


## 对网络请求做必要的缓存以避免多余的请求

小程序的资源文件托管在微信的服务器，所以小程序开发者不需要关注前端开发领域中对于静态资源的 HTTP 缓存策略。

在代码层面，将重复使用的网络请求结果缓存在代码或者storage中实现数据复用，减少不必要的网络请求个数。

## 避免短时间内发起太多的图片请求

